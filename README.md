# OpenCode Agent Automation System

ğŸ¤– **Automated AI agent delegation system for Claude and OpenCode integration**

Transform your development workflow with intelligent AI agents that work autonomously on your codebase.

## Features

- ğŸš€ **Automatic Task Detection** - Analyzes your project and generates appropriate tasks
- ğŸ”„ **Parallel Execution** - Run multiple OpenCode agents concurrently
- ğŸ“Š **Progress Monitoring** - Real-time status and logging
- ğŸ¯ **Smart Delegation** - Intelligently assigns tasks based on project context
- ğŸ”§ **Easy Integration** - Works with any project type
- ğŸ“¦ **No Dependencies** - Uses OpenCode's built-in capabilities

## Quick Install

### One-line install (recommended)

```bash
curl -fsSL https://raw.githubusercontent.com/mediafill/opencode-agent-automation/main/install.sh | bash
```

### NPM install

```bash
npm install -g opencode-agent-automation
```

### Manual install

```bash
git clone https://github.com/mediafill/opencode-agent-automation
cd opencode-agent-automation
bash install.sh
```

## Prerequisites

- **OpenCode** - Install from [opencode.ai](https://opencode.ai)
- **Python 3.7+** - For task delegation script
- **Bash** - For shell scripts

Optional:
- **Claude CLI** - For enhanced integration
- **Node.js** - For NPM installation

## Usage

### Basic Commands

After installation, use the `agents` command in your project:

```bash
# Start all agents with default tasks
agents start

# Check agent status
agents status

# Stop all agents
agents stop

# View logs
agents logs

# Delegate specific objective
agents delegate "make the application production ready"
```

### Project Setup

1. Navigate to your project directory
2. Run the installer:
   ```bash
   curl -fsSL https://raw.githubusercontent.com/mediafill/opencode-agent-automation/main/install.sh | bash
   ```
3. The installer will create a `.claude` directory with all necessary files

### Configuration

Edit `.claude/config.env` to customize:

```bash
# Maximum concurrent agents
MAX_CONCURRENT_AGENTS=4

# Agent timeout (seconds)
AGENT_TIMEOUT=900

# Auto restart failed agents
AUTO_RESTART=true

# OpenCode model selection
OPENCODE_MODEL="default"
```

### Task Definition

Create custom tasks in `.claude/tasks.json`:

```json
{
  "tasks": [
    {
      "id": "security_audit",
      "type": "security",
      "priority": "high",
      "description": "Audit code for security vulnerabilities",
      "status": "pending"
    },
    {
      "id": "add_tests",
      "type": "testing",
      "priority": "medium",
      "description": "Add unit tests for core functions",
      "status": "pending"
    }
  ]
}
```

## Examples

### Production-Ready Code Generation

The `examples/` directory contains **sample code** generated by the OpenCode Agent Automation system to demonstrate its capabilities. These are **not part of the automation tool itself**, but examples of what it can produce.

Starting with this simple objective:
```bash
agents delegate "add robust error handling and structured logging throughout application"
```

**The automation system generated:**
- ğŸ›¡ï¸ **Comprehensive security middleware** with rate limiting and input validation  
- ğŸ“Š **Structured logging system** with correlation IDs and multiple log levels
- âš¡ **Production-grade error handling** with graceful degradation
- ğŸ” **System health monitoring** with memory and uptime tracking
- ğŸ§ª **Complete testing framework** with Jest and coverage reporting

### Real-World Results

**Input:** Basic 25-line Express.js app  
**Output:** 500+ lines of production-ready code with enterprise-grade features

All generated automatically by multiple OpenCode agents working in parallel, demonstrating the power of the automation system for real development projects.

### Production Readiness

Make your application production-ready:

```bash
agents delegate "make the application production ready with security, testing, and monitoring"
```

This will automatically:
- Audit security vulnerabilities
- Add rate limiting and authentication
- Create comprehensive tests
- Add monitoring and logging
- Optimize performance
- Update documentation

### Add Testing

```bash
agents delegate "add comprehensive testing with 80% coverage"
```

### Security Audit

```bash
agents delegate "perform security audit and fix vulnerabilities"
```

### Documentation

```bash
agents delegate "create API documentation and update README"
```

## How It Works

1. **Project Analysis** - Detects project type, languages, and frameworks
2. **Task Generation** - Creates appropriate tasks based on objective
3. **Agent Spawning** - Launches OpenCode agents with specific prompts
4. **Parallel Execution** - Runs multiple agents concurrently
5. **Progress Monitoring** - Tracks and logs all agent activity
6. **Result Aggregation** - Collects and reports results

## Advanced Usage

### Claude Integration

When working in projects with the automation system installed, Claude can use the comprehensive `.claude/CLAUDE.md` guide to:

- **Coordinate with OpenCode agents** for parallel task execution
- **Monitor progress** with real-time dashboards and status reporting  
- **Manage complex objectives** by breaking them into agent-executable tasks
- **Handle integration** of agent results and resolve conflicts

```bash
# Claude can delegate comprehensive objectives
agents delegate "make the application production ready with security, testing, and monitoring"

# Monitor agent progress in real-time
agents monitor watch

# Generate web dashboard for visual progress tracking
agents monitor dashboard
```

### Custom Task Delegation

```python
from opencode_agent_automation import TaskDelegator

delegator = TaskDelegator(project_dir="/path/to/project")
tasks = delegator.generate_tasks("optimize database queries")
delegator.delegate("optimize database queries", max_concurrent=8)
```

### Monitoring API

```bash
# Get JSON status
curl http://localhost:8080/agents/status

# Stream logs
curl http://localhost:8080/agents/logs
```

### WebSocket Performance Monitoring

The system includes enhanced WebSocket monitoring with real-time performance metrics:

**Dashboard Features:**
- **Connection Metrics** - Real-time uptime, message counts, and reconnection tracking
- **Performance Visualization** - Live charts showing throughput (messages/second) and latency
- **Health Indicators** - Connection reliability percentage and average response times
- **Auto-Reconnection** - Exponential backoff with intelligent retry logic (1s to 30s delays)

**Key Metrics Tracked:**
- Uptime and connection stability
- Messages sent/received counters  
- WebSocket latency with ping/pong measurements
- Throughput calculations (messages per second)
- Reliability scoring based on connection health

```bash
# Open the dashboard to view real-time WebSocket metrics
open http://localhost:8080/dashboard

# Monitor WebSocket performance in terminal
agents monitor websocket
```

The dashboard automatically tracks connection quality and provides visual feedback on system performance, helping identify potential issues with real-time communication.

## File Structure

```
your-project/
â”œâ”€â”€ .claude/
â”‚   â”œâ”€â”€ CLAUDE.md         # Complete integration guide for Claude (enhanced by agents)
â”‚   â”œâ”€â”€ agentsync.md      # Agent coordination documentation
â”‚   â”œâ”€â”€ tasks.json        # Task definitions
â”‚   â”œâ”€â”€ config.env        # Configuration
â”‚   â”œâ”€â”€ launch.sh         # Main launcher script
â”‚   â”œâ”€â”€ run_agents.sh     # Agent runner
â”‚   â”œâ”€â”€ monitor.sh        # Advanced monitoring with dashboard
â”‚   â”œâ”€â”€ delegate.py       # Task delegation system (with structured logging)
â”‚   â”œâ”€â”€ logger.py         # Structured logging system (added by agents)
â”‚   â”œâ”€â”€ python_logger.py  # Enhanced logging utilities (added by agents)
â”‚   â””â”€â”€ logs/            # Agent logs
â”‚       â”œâ”€â”€ agent_1.log
â”‚       â”œâ”€â”€ agent_2.log
â”‚       â””â”€â”€ ...
â””â”€â”€ examples/            # Sample code generated by agents (not part of tool)
    â”œâ”€â”€ logger.js        # Example: Structured logging system
    â”œâ”€â”€ error-handler.js # Example: Error handling patterns
    â””â”€â”€ jest.config.js   # Example: Testing configuration
```

## Troubleshooting

### OpenCode not found

Install OpenCode from [opencode.ai](https://opencode.ai):

```bash
npm install -g opencode
```

### Permission denied

Make scripts executable:

```bash
chmod +x .claude/*.sh
```

### Agents not starting

Check logs:

```bash
tail -f .claude/logs/*.log
```

## Contributing

Contributions are welcome! Please read [CONTRIBUTING.md](CONTRIBUTING.md) for details.

## License

MIT License - see [LICENSE](LICENSE) file for details.

## Support

- **Issues**: [GitHub Issues](https://github.com/mediafill/opencode-agent-automation/issues)
- **Discussions**: [GitHub Discussions](https://github.com/mediafill/opencode-agent-automation/discussions)
- **Documentation**: [Wiki](https://github.com/mediafill/opencode-agent-automation/wiki)

## Acknowledgments

- OpenCode team for the amazing AI coding agent
- Claude/Anthropic for the AI capabilities
- All contributors and users

---

**Made with â¤ï¸ by the open source community**